<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects | Maojun Sun</title>
    <link rel="icon" href="https://avatars.githubusercontent.com/u/67999981" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- 1. Apple 风格全局变量 --- */
        :root {
            --primary-accent: #0066cc;
            --text-main: #1d1d1f;
            --text-secondary: #86868b;
            --bg-body: #ffffff;
            --bg-gray: #f5f5f7;
            --glass-bg: rgba(255, 255, 255, 0.8);
            --glass-border: 1px solid rgba(0,0,0,0.1);
            --nav-height: 54px;
        }

        /* --- 2. 基础重置 --- */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0; padding: 0;
            color: var(--text-main);
            background-color: var(--bg-body);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        a { text-decoration: none; color: inherit; transition: all 0.3s ease; }

        /* --- 3. 顶部磨砂导航栏 --- */
        .navbar {
            position: fixed; top: 0; left: 0; right: 0;
            height: var(--nav-height);
            background: var(--glass-bg);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-bottom: var(--glass-border);
            z-index: 1000;
            display: flex; justify-content: center; align-items: center;
        }
        .nav-inner { display: flex; gap: 40px; font-size: 13px; font-weight: 500; }
        .nav-link { color: var(--text-main); opacity: 0.8; }
        .nav-link:hover { opacity: 1; color: var(--primary-accent); }
        .nav-link.active { opacity: 1; color: var(--primary-accent); font-weight: 600; }

        /* --- 4. 布局容器 --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: calc(var(--nav-height) + 60px) 40px 60px;
        }

        /* --- 5. 卡片容器 --- */
        .main-content { min-width: 0; }
        h2 { font-size: 28px; font-weight: 700; margin-bottom: 10px; color: #000; }
        .subtitle { font-size: 15px; color: var(--text-secondary); margin-bottom: 40px; }

        /* Grid 布局 */
        #repo-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        /* 卡片样式 (复刻截图) */
        .repo-card {
            background: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            /* 顶部彩色条默认样式，会被JS动态覆盖 */
            border-top: 4px solid #0066cc;
        }

        .repo-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border-color: #d1d5da;
        }

        .repo-name {
            font-size: 16px;
            font-weight: 600;
            color: #0366d6; /* GitHub Blue */
            margin-bottom: 8px;
            word-break: break-all;
        }

        .repo-desc {
            font-size: 13px;
            color: #586069;
            margin-bottom: 20px;
            line-height: 1.5;
            flex-grow: 1; /* 让描述占据剩余空间，保证底部对齐 */
            display: -webkit-box;
            -webkit-line-clamp: 3; /* 最多显示3行，超出省略 */
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .repo-stats {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #586069;
            margin-top: auto; /* 推到底部 */
        }

        .repo-stat-item {
            display: flex;
            align-items: center;
            margin-right: 16px;
        }
        .repo-stat-item i { margin-right: 4px; }

        .repo-lang-circle {
            width: 10px; height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        /* 加载动画 */
        .loading { text-align: center; padding: 40px; color: #999; grid-column: 1 / -1; }

        /* 移动端适配 */
        @media (max-width: 768px) {
            .navbar { justify-content: center; padding: 0 20px; }
            .nav-inner { gap: 20px; }
            .container { padding: calc(var(--nav-height) + 40px) 16px 40px; }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-inner">
            <a href="index.html" class="nav-link">About</a>
            <a href="project.html" class="nav-link active">Project</a>
            <a href="gallery.html" class="nav-link">Gallery</a>
        </div>
    </nav>

    <div class="container">
        <main class="main-content" style="width: 100%;">
            <h2>Repositories</h2>
            <p class="subtitle">
                My open source projects, automatically synced from GitHub. <br>
                <a href="https://github.com/Stephen-SMJ?tab=repositories" target="_blank" style="color:var(--primary-accent); font-size:14px;">View all on GitHub &rarr;</a>
            </p>

            <div id="repo-container">
                <div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading repositories...</div>
            </div>
        </main>
    </div>

    <script>
        // 配置：你的 GitHub 用户名和所在组织
        const username = 'Stephen-SMJ';
        const orgs = ['AMA-CMFAI']; // 要展示的组织列表

        // 想要隐藏的仓库名（如果有不想展示的，写在数组里）
        const hideRepos = ['Stephen-SMJ'];

        // 颜色映射：根据卡片顶部颜色
        const colors = ['#2b7489', '#563d7c', '#3572a5', '#f1e05a', '#f34b7d', '#89e051', '#b07219'];

        async function fetchRepos() {
            const container = document.getElementById('repo-container');

            try {
                let allRepos = [];

                // 获取用户仓库
                const userResponse = await fetch(`https://api.github.com/users/${username}/repos?sort=pushed&per_page=100`);
                if (userResponse.ok) {
                    const userRepos = await userResponse.json();
                    allRepos = allRepos.concat(userRepos.map(repo => ({ ...repo, source: 'user' })));
                }

                // 获取组织仓库
                for (const org of orgs) {
                    try {
                        const orgResponse = await fetch(`https://api.github.com/orgs/${org}/repos?sort=pushed&per_page=100`);
                        if (orgResponse.ok) {
                            const orgRepos = await orgResponse.json();
                            allRepos = allRepos.concat(orgRepos.map(repo => ({ ...repo, source: 'org' })));
                        }
                    } catch (e) {
                        console.warn(`Failed to fetch repos for org ${org}`);
                    }
                }

                // 去重（根据仓库全名）
                const seen = new Set();
                allRepos = allRepos.filter(repo => {
                    const fullName = repo.full_name;
                    if (seen.has(fullName)) return false;
                    seen.add(fullName);
                    return true;
                });

                // 排序：按 Star 数量降序，Star 相同的按更新时间
                allRepos.sort((a, b) => b.stargazers_count - a.stargazers_count || new Date(b.pushed_at) - new Date(a.pushed_at));

                // 清空 Loading
                container.innerHTML = '';

                // 遍历生成 HTML
                allRepos.forEach((repo, index) => {
                    // 如果在黑名单里，跳过
                    if (hideRepos.includes(repo.name)) return;

                    // 随机或循环取一个顶部边框颜色
                    const color = colors[index % colors.length];

                    // 格式化日期 (YYYY-MM-DD)
                    const date = new Date(repo.pushed_at).toISOString().split('T')[0];

                    // 创建卡片
                    const card = document.createElement('a');
                    card.href = repo.html_url;
                    card.target = "_blank";
                    card.className = 'repo-card';
                    card.style.borderTopColor = color;

                    card.innerHTML = `
                        <div class="repo-name">${repo.name}</div>
                        <div class="repo-desc">${repo.description || 'No description provided.'}</div>
                        <div class="repo-stats">
                            ${repo.language ? `
                                <div class="repo-stat-item">
                                    <span class="repo-lang-circle" style="background-color: #666;"></span>
                                    ${repo.language}
                                </div>
                            ` : ''}
                            <div class="repo-stat-item">
                                <i class="far fa-star"></i> ${repo.stargazers_count}
                            </div>
                            <div class="repo-stat-item">
                                <i class="fas fa-code-branch"></i> ${repo.forks_count}
                            </div>
                            <div class="repo-stat-item" style="margin-left:auto;">
                                <i class="far fa-clock"></i> ${date}
                            </div>
                        </div>
                    `;

                    container.appendChild(card);
                });

            } catch (error) {
                container.innerHTML = `<div class="loading" style="color:red;">Failed to load repos. <br> ${error.message}</div>`;
            }
        }

        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', fetchRepos);
    </script>
</body>
</html>